<!DOCTYPE html>
<html>
  <head>
    <script src="/sdk/app-page-sdk.js"></script>
    <title>Simple Map with Button</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      #map {
        height: 400px;
      }
    </style>
  </head>
  <body>
	<div class="map-container" style="padding: 40px">
    <div id="map"></div>
	</div>
    <form class="text-center mt-4">
      <input type="hidden" name="latitude" id="latitude">
      <input type="hidden" name="longitude" id="longitude">
      <button
        id="getLocationBtn"
        type="submit"
        class="inline-flex items-center gap-x-1.5 whitespace-nowrap rounded-md bg-blue-700 px-5 py-3 text-sm font-semibold text-white shadow-sm hover:bg-blue-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-700"
        onclick="sendLocation()"
      >
        Send your Location
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          strokeWidth="{1.5}"
          stroke="currentColor"
          class="h-5 w-7 flex-shrink-0"
          className="w-6 h-6"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"
          />
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
          />
        </svg>
      </button>
      </form>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
      var map = L.map("map").setView([51.1387236052858, 6.867809980364718], 11);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Cognigy OpenStreetMap xApp",
      }).addTo(map);

      var currentMarker = L.marker([51.1387236052858, 6.867809980364718]).addTo(
        map
      );


      map.on("click", function (e) {
            var lat = e.latlng.lat;
            var lng = e.latlng.lng;

            if (currentMarker) {
                map.removeLayer(currentMarker);
            }

            currentMarker = L.marker([lat, lng]).addTo(map);
            document.getElementById("latitude").value = lat;
            document.getElementById("longitude").value = lng;
        });

        window.addEventListener("load", () => {
            const form = document.querySelector("form");
            form.onsubmit = (e) => {
                e.preventDefault();
                e.stopPropagation();
                const formData = new FormData(form);
                const values = [...formData.entries()].reduce(
                    (obj, [key, value]) => {
                        obj[key] = value;
                        return obj;
                    },
                    {}
                );

                SDK.submit(values);
            };
        });
    </script>
  </body>
</html>
